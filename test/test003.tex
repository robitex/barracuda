% !TeX program = LuaTeX

\newbox\mybox

\directlua{
local barracuda = require "barracuda"

local c39builder, err = barracuda:load_builder("code39")
assert(not err, err)


local enc_c39_default, err = c39builder:new_encoder("default")
assert(not err, err)

enc_c39_default:set_param("quietzone", tex.sp "2mm")

local symb = enc_c39_default:from_string("ABC12345")
symb:set_param("height", 3000000)

local _, err1 = symb:set_param("text_enabled", true)
if err1 then tex.print(err1) end

local te, err2 = symb:get_param([[text_enabled]])
if err2 then tex.print(err2) end

if te == true then
    tex.print("text-enabled is true")
elseif te == false then
    tex.print("true")
else
    error("Ops")
end

local canvas = barracuda:new_canvas()
symb:append_graphic(canvas)

local drv, err = barracuda:load_driver("native")
assert(not err, err)

print([[****canvas****]])
for _, opcode in ipairs(canvas._data) do
    print(opcode)
end
print([[****canvas****]])

drv:ga_to_hbox(canvas, "mybox")
}

A\box\mybox A


\bye
