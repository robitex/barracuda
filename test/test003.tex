% !TeX program = LuaTeX
% Copyright (C) 2018 Roberto Giacomelli

\newbox\mybox
\nopagenumbers

\directlua{
local barracuda = require "barracuda"

local c39, err = barracuda:load_builder("code39")
assert(not err, err)

local enc_c39_default, err = c39builder:new_encoder("default")
assert(not err, err)

enc_c39_default:set_param("quietzone", tex.sp "2mm")

local symbo, err = enc_c39_default:from_string("ABC12QJ31")
assert(not err, err)

symbo:set_param("height", 3000000)
local _, err1 = symbo:set_param("text_enabled", true)
if err1 then tex.print(err1) end

local te, err2 = symbo:get_param([[text_enabled]])
if err2 then tex.print(err2) end

if te == true then
    tex.print("text-enabled is true")
elseif te == false then
    tex.print("text-enabled is false")
else
    error("Ops")
end

local _, err3 = symbo:set_param{
    text_pos = "spaced-top",
    interspace = 300000,
    text_star = true,
    text_gap = 65536 * 10,
}
assert(not err3, err3)

local canvas = barracuda:new_canvas()
symbo:append_graphic(canvas)

local drv, err = barracuda:load_driver("native")
assert(not err, err)

print([[****canvas****]])
for _, opcode in ipairs(canvas._data) do
    print(opcode)
end
print([[****canvas****]])

drv:ga_to_hbox(canvas, "mybox")
}
\vrule A\vrule\box\mybox \vrule A\vrule
\bye
